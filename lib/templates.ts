/**
 * ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
 * ã‚¿ã‚¹ã‚¯ 8.1: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆæ©Ÿèƒ½ã®å®Ÿè£…
 */

import type { Proposal } from "../types";

/**
 * ã‚¹ãƒ‹ãƒšãƒƒãƒˆå®šç¾©ã‚’ YAML å½¢å¼ã§ç”Ÿæˆ
 * @param proposal ã‚¹ãƒ‹ãƒšãƒƒãƒˆææ¡ˆ
 * @returns YAML å½¢å¼ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆå®šç¾©
 */
export function generateSnippetYAML(proposal: Proposal): string {
  if (!("snippet" in proposal.payload)) {
    throw new Error("This proposal is not a snippet");
  }

  const { text, alias } = proposal.payload.snippet;

  // Raycast Snippets ã® YAML å½¢å¼
  return `# ${proposal.title}
# ${proposal.rationale}

- name: ${alias}
  keyword: ${alias}
  text: |
    ${text}`;
}

/**
 * ãƒã‚¯ãƒ­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ Shell ã‚¹ã‚¯ãƒªãƒ—ãƒˆå½¢å¼ã§ç”Ÿæˆ
 * @param proposal ãƒã‚¯ãƒ­ææ¡ˆ
 * @returns Shell ã‚¹ã‚¯ãƒªãƒ—ãƒˆå½¢å¼ã®ãƒã‚¯ãƒ­
 */
export function generateMacroShell(proposal: Proposal): string {
  if (!("macro" in proposal.payload)) {
    throw new Error("This proposal is not a macro");
  }

  const { sequence } = proposal.payload.macro;

  // Raycast Script Commands å½¢å¼
  let script = `#!/bin/bash

# Required parameters:
# @raycast.schemaVersion 1
# @raycast.title ${proposal.title}
# @raycast.mode silent

# Optional parameters:
# @raycast.icon ğŸ”—
# @raycast.description ${proposal.rationale}

# Documentation:
# @raycast.author Command Clinic
# @raycast.authorURL https://github.com/command-clinic

# Generated by Command Clinic
# Macro sequence detected from usage patterns

`;

  // ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ Shell ã‚³ãƒãƒ³ãƒ‰ã«å¤‰æ›
  sequence.forEach((aliasId, index) => {
    script += `# Step ${index + 1}: ${aliasId}\n`;
    script += `open "raycast://extensions/command-clinic/launcher?alias=${aliasId}"\n`;
    if (index < sequence.length - 1) {
      script += `sleep 1  # Wait for command to complete\n`;
    }
    script += `\n`;
  });

  script += `echo "Macro completed successfully"\n`;

  return script;
}

/**
 * ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚¬ã‚¤ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
 * @param proposal ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆææ¡ˆ
 * @returns ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸã‚¬ã‚¤ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆ
 */
export function formatShortcutGuide(proposal: Proposal): string {
  if (!("shortcut" in proposal.payload)) {
    throw new Error("This proposal is not a shortcut");
  }

  const { aliasId, suggestedHotkey } = proposal.payload.shortcut;

  return `# ${proposal.title}

**æ¨å¥¨ãƒ›ãƒƒãƒˆã‚­ãƒ¼**: ${suggestedHotkey}

## è¨­å®šæ‰‹é †

1. Raycast ã‚’é–‹ãï¼ˆâŒ˜ + Spaceï¼‰
2. "Settings" ã¨å…¥åŠ›ã—ã¦è¨­å®šç”»é¢ã‚’é–‹ã
3. "Extensions" ã‚¿ãƒ–ã‚’é¸æŠ
4. "Command Clinic" æ‹¡å¼µæ©Ÿèƒ½ã‚’æ¢ã™
5. "${aliasId}" ã‚³ãƒãƒ³ãƒ‰ã‚’è¦‹ã¤ã‘ã‚‹
6. "Record Hotkey" ã‚’ã‚¯ãƒªãƒƒã‚¯
7. ${suggestedHotkey} ã‚’æŠ¼ã™
8. å®Œäº†ï¼

## ç†ç”±

${proposal.rationale}

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯éå»7æ—¥é–“ã§ ${proposal.evidence.count || 0} å›èµ·å‹•ã•ã‚Œã¦ã„ã¾ã™ã€‚
ãƒ›ãƒƒãƒˆã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€ã•ã‚‰ã«åŠ¹ç‡çš„ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚`;
}

/**
 * ææ¡ˆã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰ã‚’ç”Ÿæˆ
 * @param proposal ä»»æ„ã®ææ¡ˆ
 * @returns å®Ÿè£…ã‚¬ã‚¤ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆ
 */
export function generateImplementationGuide(proposal: Proposal): string {
  switch (proposal.type) {
    case "shortcut":
      return formatShortcutGuide(proposal);
    case "snippet":
      return `# ã‚¹ãƒ‹ãƒšãƒƒãƒˆå®šç¾©\n\n\`\`\`yaml\n${generateSnippetYAML(proposal)}\n\`\`\`\n\n## é©ç”¨æ–¹æ³•\n\n1. ä¸Šè¨˜ã® YAML ã‚’ã‚³ãƒ”ãƒ¼\n2. Raycast Settings > Extensions > Snippets ã‚’é–‹ã\n3. æ—¢å­˜ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«è²¼ã‚Šä»˜ã‘\n4. ä¿å­˜ã—ã¦å®Œäº†`;
    case "macro":
      return `# ãƒã‚¯ãƒ­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ\n\n\`\`\`bash\n${generateMacroShell(proposal)}\n\`\`\`\n\n## é©ç”¨æ–¹æ³•\n\n1. ä¸Šè¨˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼\n2. Raycast Script Commands ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜\n   ï¼ˆé€šå¸¸: ~/Documents/Raycast/Scripts/ï¼‰\n3. ãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸: \`chmod +x script.sh\`\n4. Raycast ã‹ã‚‰å®Ÿè¡Œå¯èƒ½ã«`;
    default:
      return "Unknown proposal type";
  }
}
