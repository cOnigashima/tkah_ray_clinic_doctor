# Command Critic - 統合テストチェックリスト

## タスク 11.1: コンポーネント間の統合確認

### 1. ランチャーとログマネージャーの接続確認

#### テストケース 1.1: 入力ログの記録
- [ ] ランチャーを起動: `npm run dev` → Launcher コマンド実行
- [ ] 検索バーにテキストを入力: 例 "test search"
- [ ] ログファイルを確認: `~/Library/Application Support/com.raycast.macos/extensions/command-critic-raycast/logs-YYYY-MM-DD.jsonl`
- [ ] 期待結果: InputEvent が記録されている
  ```json
  {"type":"input","ts":1234567890,"text":"test search","len":11}
  ```

#### テストケース 1.2: 起動ログの記録
- [ ] エイリアスを選択して起動
- [ ] ログファイルを確認
- [ ] 期待結果: LaunchEvent が記録されている
  ```json
  {"type":"launch","ts":1234567890,"aliasId":"file-search","target":{"owner":"raycast","extension":"file-search","command":"search-files"}}
  ```

### 2. 分析フローのエンドツーエンド動作確認

#### テストケース 2.1: ログ読み込み
- [ ] 複数日分のログを作成（手動またはLauncher使用）
- [ ] Critic コマンドを実行
- [ ] 期待結果: ローディング表示が表示される

#### テストケース 2.2: Claude API 呼び出し
- [ ] API キーを設定: Raycast Settings > Extensions > Command Critic > Preferences
- [ ] Critic コマンドで分析実行
- [ ] 期待結果:
  - API キー未設定時 → エラーメッセージ表示
  - API キー設定済み → 分析実行、提案表示または「データ不足」メッセージ

#### テストケース 2.3: 提案の表示
- [ ] 十分なログデータがある場合、提案リストが表示される
- [ ] 提案をクリックすると詳細が表示される
- [ ] 期待結果: Markdown形式で提案内容が表示される

### 3. エイリアス管理と起動機能の統合テスト

#### テストケース 3.1: エイリアスの保存と読み込み
- [ ] Onboarding コマンドを実行
- [ ] 3つのエイリアスを登録
- [ ] 保存完了メッセージが表示される
- [ ] Launcher を再起動
- [ ] 期待結果: 登録したエイリアスが表示される

#### テストケース 3.2: エイリアスの起動
- [ ] Launcher でエイリアスを選択
- [ ] Raycast 標準機能の起動を確認
- [ ] 期待結果: コマンドが正常に起動される

### 4. オンボーディング完了後の動作確認

#### テストケース 4.1: 初回セットアップ
- [ ] Onboarding コマンドを実行
- [ ] すべてのフィールドを入力（2分以内）
- [ ] 送信ボタンをクリック
- [ ] 期待結果:
  - 完了メッセージ表示
  - aliases.json が作成される
  - Launcher で登録済みエイリアスが表示される

---

## タスク 11.2: 手動テストとMVP検証

### 1. オンボーディングフローの2分以内完了確認

#### テスト手順
1. [ ] Onboarding コマンドを起動
2. [ ] タイマー開始
3. [ ] デフォルト値を使用して素早く入力
4. [ ] 送信して完了
5. [ ] タイマー停止
6. [ ] 期待結果: 2分以内に完了

**実測時間**: ______秒

### 2. ログ収集の正確性検証

#### テスト手順
1. [ ] Launcher を使用して5回以上の検索を実行
2. [ ] 3つ以上のエイリアスを起動
3. [ ] ログファイルを確認: `cat ~/Library/Application\ Support/.../logs-*.jsonl`
4. [ ] 期待結果:
   - すべての入力イベントが記録されている
   - すべての起動イベントが記録されている
   - JSON形式が正しい

**記録されたイベント数**:
- InputEvent: ______個
- LaunchEvent: ______個

### 3. AI分析と提案表示の動作確認

#### テスト手順（データ不足の場合）
1. [ ] ログが少ない状態で Critic を実行
2. [ ] 期待結果: "データ不足" メッセージが表示される

#### テスト手順（十分なデータがある場合）
1. [ ] 3日以上の操作ログを蓄積
2. [ ] Critic コマンドを実行
3. [ ] 期待結果:
   - ローディング表示 → 提案リスト表示
   - 最大3件の提案
   - 各提案に証拠データと信頼度スコア

**表示された提案数**: ______個

### 4. エラーケースの網羅的テスト

#### エラーケース 4.1: API キー未設定
- [ ] API キーを削除
- [ ] Critic コマンドを実行
- [ ] 期待結果: 適切なエラーメッセージとPreferences設定への誘導

#### エラーケース 4.2: ネットワークエラー
- [ ] ネットワークを切断
- [ ] Critic コマンドを実行
- [ ] 期待結果: タイムアウトエラーと再試行ガイダンス

#### エラーケース 4.3: ファイルアクセスエラー
- [ ] supportPath のアクセス権限を変更（read-only）
- [ ] Launcher で入力
- [ ] 期待結果: 静かに失敗（ユーザー体験を中断しない）

#### エラーケース 4.4: 破損したログファイル
- [ ] ログファイルに不正なJSONを追加
- [ ] Critic コマンドを実行
- [ ] 期待結果: 破損した行をスキップして処理継続

### 5. セキュリティとプライバシー機能の検証

#### テスト 5.1: ローカルファースト保存
- [ ] ネットワークモニターを開く
- [ ] Launcher で操作を実行
- [ ] 期待結果: 外部へのHTTPリクエストなし

#### テスト 5.2: 分析時のみデータ送信
- [ ] ネットワークモニターを開く
- [ ] Critic コマンドを実行
- [ ] 期待結果: Claude API (api.anthropic.com) へのリクエストのみ

#### テスト 5.3: 7日後の自動削除
- [ ] 8日前のログファイルを手動作成
- [ ] Launcher を起動（cleanOldLogs 実行）
- [ ] 期待結果: 古いログファイルが削除される

#### テスト 5.4: 手動データ削除
- [ ] Clear Logs コマンドを実行
- [ ] ログファイル一覧を読み込み
- [ ] すべて削除を実行
- [ ] 期待結果: 確認ダイアログ → 削除完了メッセージ

### 6. 最適化アクションの動作確認

#### テスト 6.1: スニペット定義のコピー
- [ ] Critic で snippet 提案を表示
- [ ] "Copy Snippet Definition" をクリック
- [ ] クリップボードを確認: `pbpaste`
- [ ] 期待結果: YAML形式のスニペット定義がコピーされている

#### テスト 6.2: マクロテンプレートのコピー
- [ ] Critic で macro 提案を表示
- [ ] "Copy Macro Template" をクリック
- [ ] 期待結果: Shell スクリプトがコピーされている

#### テスト 6.3: Raycast 設定へのディープリンク
- [ ] Critic で shortcut 提案を表示
- [ ] "Open Raycast Settings" をクリック
- [ ] 期待結果: Raycast Settings が開く

---

## 統合テスト結果サマリー

### テスト実行日時
**日付**: ____________
**実行者**: ____________

### 結果
- [ ] すべてのテストケースをパス
- [ ] 一部失敗（詳細を下記に記載）
- [ ] 重大な問題あり

### 問題点
<!-- ここに発見された問題を記載 -->

### 改善提案
<!-- ここに改善案を記載 -->

---

## MVPリリース判定

### リリース基準チェック
- [ ] コア機能が動作する（ログ収集、分析、提案表示）
- [ ] セキュリティ要件を満たす（ローカル保存、APIキー管理）
- [ ] 重大なバグがない
- [ ] オンボーディングが2分以内に完了可能
- [ ] エラーハンドリングが適切

### 判定結果
- [ ] **リリース可**: MVPとして出荷可能
- [ ] **条件付きリリース可**: 軽微な問題あり、後で修正
- [ ] **リリース不可**: 重大な問題あり、修正必要

### コメント
<!-- 総合的な評価コメント -->
